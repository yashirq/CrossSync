<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CrossSync</title>
  <meta name="description" content="CrossSync - 跨平台文件同步/传输工具，支持 iPhone、Android 与 Windows 之间的快速安全传输">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="background-transfer-styles.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0ea5e9">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">CS</span>
      <span class="brand-text">CrossSync</span>
    </div>
    <div class="status" id="connectionStatus" aria-live="polite">
      <span class="dot" id="connectionIndicator"></span>
      等待连接其他设备...
    </div>
  </header>

  <main class="grid">
    <section class="card connect" id="connectionArea">
      <h2 id="connectTitle">连接设备</h2>
      <div class="device-summary">
        <div class="device-icon-dot"></div>
        <div class="device-meta">
          <div class="device-name" id="deviceName">正在识别设备...</div>
          <div class="badge badge-offline" id="deviceStatus">离线</div>
        </div>
      </div>

      <div class="qr" id="qrContainer"></div>

      <div class="room-line">
        房间 ID：<span id="roomId">-</span>
        <button class="btn ghost" id="copyRoomBtn" onclick="app && app.copyRoomId && app.copyRoomId()" type="button">复制</button>
      </div>

      <div class="controls" id="connectionControls" style="display:none">
        <button class="btn primary" id="reconnectBtn" onclick="app && app.manualReconnect && app.manualReconnect()" type="button">重新连接</button>
        <button class="btn gray" id="resetBtn" onclick="app && app.resetConnection && app.resetConnection()" type="button">重置连接</button>
      </div>

      <div class="devices-list" id="devicesList" style="display:none">
        <h3>附近设备</h3>
        <div class="devices" id="devicesContainer"></div>
      </div>
    </section>

    <section class="card transfer" id="fileTransfer" style="display:none">
      <h2>文件传输</h2>
      <div class="dropzone" id="uploadArea" role="region" aria-label="文件上传区域" tabindex="0">
        <div class="dz-title">拖拽到此或点击选择</div>
        <div class="dz-sub">支持多个文件同时传输</div>
        <input type="file" id="fileInput" multiple accept="*/*" style="display:none">
        <button class="btn primary" id="selectBtn" type="button">选择文件</button>
      </div>

      <div class="progress" id="progressArea" style="display:none">
        <div class="p-head">
          <span class="p-name" id="fileName">文件名</span>
          <span class="p-text" id="progressText">0%</span>
        </div>
        <div class="p-bar"><div class="p-fill" id="progressFill" style="width:0%"></div></div>
      </div>

      <div class="received" id="receivedFiles" style="display:none">
        <h3>已接收</h3>
        <div style="margin:6px 0 10px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="zipAllBtn" type="button">打包成 ZIP 再下载</button>
          <button class="btn gray" id="clearReceivedBtn" type="button">清空已接收</button>
        </div>
        <div class="files" id="filesList"></div>
      </div>

      <div class="tip" id="backgroundTip" style="display:none">
        <strong>后台传输提示：</strong>
        请保持浏览器前台或后台运行，避免设备进入省电休眠；传输完成将有系统通知。
      </div>
    </section>
  </main>

  <footer class="footer">
    <div>支持所有现代浏览器 · 基于 WebRTC</div>
    <div class="links">
      <a href="#" id="helpBtn">使用帮助</a>
      <a href="#" id="aboutBtn">关于</a>
    </div>
  </footer>

  <!-- 帮助弹窗（默认隐藏） -->
  <div class="modal" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" style="display:none">
    <div class="modal-content">
      <span class="close" id="closeHelp" role="button" aria-label="关闭">×</span>
      <h2 id="helpTitle">使用帮助</h2>
      <div class="help-content">
        <h3>如何使用：</h3>
        <ol>
          <li>确保两台设备连接到同一 WiFi 网络</li>
          <li>在手机端打开浏览器访问本页面</li>
          <li>在电脑端打开浏览器访问本页面</li>
          <li>一端创建房间，另一端扫码加入</li>
          <li>选择文件即可开始传输</li>
        </ol>
        <h3>支持的文件类型：</h3>
        <p>图片、视频、文档、音频等常见类型均支持</p>
        <h3>安全性：</h3>
        <p>文件直接在设备间传输，不经过服务器存储</p>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="main.js"></script>
</body>
</html>

